{"version":3,"file":"analytics-core.umd.js","sources":["../js/core/analytics-core.module.mjs"],"sourcesContent":["'use strict';\r\n\r\n// Analytics Core - ES Module implementation\r\n// This is the canonical implementation moved from analytics-core.js\r\n// Exported as named exports and as default `AnalyticsCore` object.\r\n\r\n// ===================== Import from metrics-constants =====================\r\nconst M = globalThis.METRICS || {};\r\nconst SCALES = M.SCALES || { INDEX_MIN: 0, INDEX_MAX: 100, DIVERGENCE_MIN: -100, DIVERGENCE_MAX: 100 };\r\nconst THRESHOLDS = M.THRESHOLDS || {};\r\nconst DEFAULTS = M.DEFAULTS || { volDurability: 50, INFINITE_RATIO: null };\r\n\r\n// ===================== Safe Math Helpers =====================\r\n\r\nfunction safeDiv(a, b, fallback = 0) {\r\n    const na = Number(a) || 0;\r\n    const nb = Number(b);\r\n    return (Number.isFinite(nb) && nb !== 0) ? (na / nb) : fallback;\r\n}\r\n\r\nfunction toNum(v) {\r\n    if (v === undefined || v === null) return 0;\r\n    if (typeof v === 'number') return v;\r\n    const s = String(v).replace(/,/g, '');\r\n    const n = Number(s);\r\n    return Number.isFinite(n) ? n : 0;\r\n}\r\n\r\nfunction clamp(v, min, max) {\r\n    return Math.max(min, Math.min(max, v));\r\n}\r\n\r\nfunction normalizeMetric(value, fromMin, fromMax, toMin = 0, toMax = 100) {\r\n    if (!Number.isFinite(value)) return (toMin + toMax) / 2;\r\n    if (fromMax === fromMin) return toMin;\r\n    const normalized = ((value - fromMin) / (fromMax - fromMin)) * (toMax - toMin) + toMin;\r\n    return clamp(normalized, toMin, toMax);\r\n}\r\n\r\nfunction mapTo0_100(value, fromMin = 0, fromMax = 100) {\r\n    return normalizeMetric(value, fromMin, fromMax, 0, 100);\r\n}\r\n\r\nfunction mapToNeg100_100(value, fromMin = -1, fromMax = 1) {\r\n    return normalizeMetric(value, fromMin, fromMax, -100, 100);\r\n}\r\n\r\n// ===================== Statistical Functions =====================\r\n\r\nfunction meanStd(arr) {\r\n    if (!arr || arr.length === 0) return { mean: 0, std: 0 };\r\n    const nums = arr.filter(x => Number.isFinite(x));\r\n    if (nums.length === 0) return { mean: 0, std: 0 };\r\n    const mean = nums.reduce((a, b) => a + b, 0) / nums.length;\r\n    const variance = nums.reduce((acc, x) => acc + Math.pow(x - mean, 2), 0) / nums.length;\r\n    return { mean, std: Math.sqrt(variance) };\r\n}\r\n\r\nfunction zScore(value, mean, std) {\r\n    if (!Number.isFinite(std) || std === 0) return 0;\r\n    return (value - mean) / std;\r\n}\r\n\r\nfunction safeZScore(value, mean, std, fallback = 0) {\r\n    if (!Number.isFinite(std) || std === 0) return fallback;\r\n    const v = Number(value);\r\n    const m = Number(mean);\r\n    if (!Number.isFinite(v) || !Number.isFinite(m)) return fallback;\r\n    return (v - m) / std;\r\n}\r\n\r\nfunction percentile(arr, p) {\r\n    if (!arr || arr.length === 0) return 0;\r\n    const sorted = [...arr].sort((a, b) => a - b);\r\n    const idx = Math.floor((p / 100) * sorted.length);\r\n    return sorted[Math.min(idx, sorted.length - 1)];\r\n}\r\n\r\n// ===================== ATR Calculation =====================\r\n\r\nfunction computeATR(history, period = 14) {\r\n    if (!history || history.length < 2) return 0;\r\n    \r\n    const trs = [];\r\n    for (let i = 1; i < history.length; i++) {\r\n        const curr = history[i];\r\n        const prev = history[i - 1];\r\n        const high = toNum(curr.high) || toNum(curr.last);\r\n        const low = toNum(curr.low) || toNum(curr.last);\r\n        const prevClose = toNum(prev.last) || toNum(prev.close);\r\n        \r\n        const tr = Math.max(\r\n            high - low,\r\n            Math.abs(high - prevClose),\r\n            Math.abs(low - prevClose)\r\n        );\r\n        trs.push(tr);\r\n    }\r\n    \r\n    if (trs.length === 0) return 0;\r\n    const lookback = Math.min(period, trs.length);\r\n    const sum = trs.slice(-lookback).reduce((a, b) => a + b, 0);\r\n    return safeDiv(sum, lookback, 0);\r\n}\r\n\r\n// ===================== Volume Calculations =====================\r\n\r\nfunction calculateVolRatio(buy, sell) {\r\n    const numBuy = toNum(buy);\r\n    const numSell = toNum(sell);\r\n    \r\n    if (numSell > 0) return (numBuy / numSell) * 100;\r\n    if (numBuy > 0) return null; // Infinite ratio\r\n    return 0;\r\n}\r\n\r\nfunction calculateVolDurability(buy, sell, fallback = 50) {\r\n    const total = toNum(buy) + toNum(sell);\r\n    if (total <= 0) return fallback;\r\n\r\n    return clamp((toNum(buy) / total) * 100, 0, 100);\r\n}\r\n\r\n// ===================== Tier-1 Advanced Formulas =====================\r\n\r\nfunction computeKyleLambda(history, opts = {}) {\r\n    const lookback = opts.lookbackPeriods || 20;\r\n    const minSamples = opts.minSamples || 10;\r\n    const smoothing = opts.smoothingWindow || 5;\r\n    if (!history || history.length < minSamples) return { valid: false, reason: 'INSUFFICIENT_DATA' };\r\n\r\n    const slice = history.slice(-lookback);\r\n    const lambdas = [];\r\n    for (let i = 1; i < slice.length; i++) {\r\n        const prev = slice[i - 1];\r\n        const cur = slice[i];\r\n        const p0 = toNum(prev.price) || toNum(prev.last) || 0;\r\n        const p1 = toNum(cur.price) || toNum(cur.last) || 0;\r\n        const vol0 = (toNum(prev.volBuy2h) || 0) + (toNum(prev.volSell2h) || 0) || (toNum(prev.vol) || 0);\r\n        const vol1 = (toNum(cur.volBuy2h) || 0) + (toNum(cur.volSell2h) || 0) || (toNum(cur.vol) || 0);\r\n        const dp = p1 - p0;\r\n        const dv = vol1 - vol0;\r\n        if (dv !== 0) lambdas.push(dp / dv);\r\n    }\r\n    if (lambdas.length < minSamples) return { valid: false, reason: 'INSUFFICIENT_SAMPLES' };\r\n\r\n    const avg = lambdas.reduce((s, v) => s + v, 0) / lambdas.length;\r\n    const smoothWindow = Math.min(smoothing, lambdas.length);\r\n    const smoothVals = lambdas.slice(-smoothWindow);\r\n    const smooth = smoothVals.reduce((s, v) => s + v, 0) / smoothVals.length;\r\n\r\n    const abs = Math.abs(smooth);\r\n    const normalized = mapTo0_100(Math.min(abs * 1000, 100), 0, 100);\r\n    const interpretation = abs > 0.01 ? 'ILLiquid' : (abs > 0.001 ? 'MODERATE_LIQUID' : 'LIQUID');\r\n    const className = abs > 0.01 ? 'text-danger' : (abs > 0.001 ? 'text-warning' : 'text-success');\r\n\r\n    return {\r\n        valid: true,\r\n        value: smooth,\r\n        rawMean: avg,\r\n        normalized: normalized,\r\n        interpretation,\r\n        className\r\n    };\r\n}\r\n\r\nfunction computeVWAPBands(history, opts = {}) {\r\n    const lookback = opts.lookbackPeriods || 120;\r\n    const stdMultiplier = typeof opts.stdMultiplier === 'number' ? opts.stdMultiplier : 2.0;\r\n    const adaptive = !!opts.adaptiveMultiplier;\r\n    const minM = opts.minMultiplier || 1.5;\r\n    const maxM = opts.maxMultiplier || 3.0;\r\n    if (!history || !history.length) return { valid: false, reason: 'INSUFFICIENT_DATA' };\r\n\r\n    const slice = history.slice(-lookback);\r\n    let num = 0, den = 0;\r\n    const prices = [];\r\n    for (const p of slice) {\r\n        const price = toNum(p.price) || toNum(p.last) || 0;\r\n        const vol = (toNum(p.volBuy2h) || 0) + (toNum(p.volSell2h) || 0) || (toNum(p.vol) || 0) || 0;\r\n        if (price && vol) {\r\n            num += price * vol;\r\n            den += vol;\r\n        }\r\n        if (price) prices.push({ price, vol });\r\n    }\r\n    const vwap = den > 0 ? num / den : (prices.length ? prices[prices.length - 1].price : 0);\r\n\r\n    let varNum = 0;\r\n    for (const pv of prices) {\r\n        varNum += pv.vol * Math.pow(pv.price - vwap, 2);\r\n    }\r\n    const std = den > 0 ? Math.sqrt(varNum / den) : 0;\r\n\r\n    let mult = stdMultiplier;\r\n    if (adaptive && std > 0 && vwap > 0) {\r\n        const rel = std / Math.max(1e-8, vwap);\r\n        mult = clamp(stdMultiplier * (1 + rel * 5), minM, maxM);\r\n    }\r\n\r\n    const upper = vwap + mult * std;\r\n    const lower = vwap - mult * std;\r\n    const position = vwap === 0 ? 'N/A' : ( (prices.length && prices[prices.length-1].price > upper) ? 'ABOVE_VWAP' : (prices.length && prices[prices.length-1].price < lower) ? 'BELOW_VWAP' : 'AT_VWAP' );\r\n    const deviationPct = vwap > 0 ? ((prices.length ? (prices[prices.length-1].price - vwap) : 0) / vwap) * 100 : 0;\r\n\r\n    const signal = position === 'ABOVE_VWAP' && Math.abs(deviationPct) > (std/vwap*100) ? 'OVERBOUGHT_WARNING' : (position === 'BELOW_VWAP' ? 'OVERSOLD' : 'NONE');\r\n\r\n    return {\r\n        valid: true,\r\n        vwap,\r\n        upperBand: upper,\r\n        lowerBand: lower,\r\n        std,\r\n        multiplier: mult,\r\n        currentPosition: position,\r\n        deviationPct,\r\n        signal,\r\n        className: signal === 'OVERBOUGHT_WARNING' ? 'text-danger' : (signal === 'OVERSOLD' ? 'text-success' : 'text-muted')\r\n    };\r\n}\r\n\r\nfunction computeCVD(history, opts = {}) {\r\n    const windowOpt = opts.window || 'all';\r\n    const normalization = opts.normalizationMethod || 'total';\r\n    const smooth = opts.smoothingPeriod || 0;\r\n    if (!history || !history.length) return { valid: false, reason: 'INSUFFICIENT_DATA' };\r\n\r\n    const slice = history.slice(- (windowOpt === 'all' ? history.length : windowOpt));\r\n    let cvd = 0;\r\n    let totalVol = 0;\r\n    for (const p of slice) {\r\n        const buy = toNum(p.volBuy2h) || toNum(p.buy) || toNum(p.vol_buy) || 0;\r\n        const sell = toNum(p.volSell2h) || toNum(p.sell) || toNum(p.vol_sell) || 0;\r\n        const delta = buy - sell;\r\n        cvd += delta;\r\n        totalVol += Math.abs(buy) + Math.abs(sell);\r\n    }\r\n    let normalized = cvd;\r\n    if (normalization === 'total' && totalVol > 0) normalized = cvd / totalVol;\r\n\r\n    const absNorm = Math.abs(normalized);\r\n    let trend = 'NEUTRAL';\r\n    if (absNorm > 0.05) trend = (normalized > 0) ? 'ACCUMULATION' : 'DISTRIBUTION';\r\n    const strength = absNorm > 0.2 ? 'STRONG' : absNorm > 0.08 ? 'MODERATE' : 'WEAK';\r\n\r\n    return {\r\n        valid: true,\r\n        value: cvd,\r\n        normalized,\r\n        trend,\r\n        strength,\r\n        className: trend === 'ACCUMULATION' ? 'text-success' : (trend === 'DISTRIBUTION' ? 'text-danger' : 'text-muted')\r\n    };\r\n}\r\n\r\nfunction computeRVOL(history, opts = {}) {\r\n    const baselinePeriods = opts.baselinePeriods || 14;\r\n    const minSamples = opts.minSamplesRequired || 10;\r\n    if (!history || history.length < minSamples) return { valid: false, reason: 'INSUFFICIENT_DATA' };\r\n\r\n    const slice = history.slice(-Math.max(baselinePeriods, 1) - 1);\r\n    const vols = [];\r\n    for (const p of slice.slice(0, -1)) {\r\n        const vol = (toNum(p.volBuy2h) || 0) + (toNum(p.volSell2h) || 0) || toNum(p.vol) || 0;\r\n        vols.push(Math.max(vol, 1));\r\n    }\r\n    const baseline = vols.length ? vols.reduce((s, v) => s + v, 0) / vols.length : 1;\r\n    const last = slice.length ? slice[slice.length - 1] : null;\r\n    const current = last ? ((toNum(last.volBuy2h) || 0) + (toNum(last.volSell2h) || 0) || toNum(last.vol) || 0) : 0;\r\n    const value = baseline > 0 ? (current / baseline) : null;\r\n    let significance = 'NONE';\r\n    if (!value || value < 1.2) significance = 'LOW';\r\n    else if (value < 2.0) significance = 'MODERATE';\r\n    else significance = 'HIGH';\r\n\r\n    return {\r\n        valid: true,\r\n        value,\r\n        baseline,\r\n        current,\r\n        significance,\r\n        className: significance === 'HIGH' ? 'text-warning fw-bold' : (significance === 'MODERATE' ? 'text-warning' : 'text-muted')\r\n    };\r\n}\r\n\r\nfunction normalizeKyleLambda(input, opts = {}) {\r\n    const val = (input && typeof input === 'object') ? (Number(input.value) || 0) : Number(input || 0);\r\n    const abs = Math.abs(val);\r\n    const max = (opts.max || 0.02);\r\n    const score = mapTo0_100(Math.min(abs, max), 0, max);\r\n    return Math.round(score);\r\n}\r\n\r\nfunction normalizeVWAP(vwapBands, opts = {}) {\r\n    if (!vwapBands || typeof vwapBands !== 'object') return 50;\r\n    const dev = Number(vwapBands.deviationPct) || 0;\r\n    const min = (opts.minPercent || -5);\r\n    const max = (opts.maxPercent || 5);\r\n    return Math.round(mapTo0_100(dev, min, max));\r\n}\r\n\r\nfunction normalizeCVD(cvdObj, opts = {}) {\r\n    const v = (cvdObj && typeof cvdObj === 'object' && Number.isFinite(Number(cvdObj.normalized))) ? Number(cvdObj.normalized) : (Number(cvdObj) || 0);\r\n    return Math.round(mapTo0_100(v, -1, 1));\r\n}\r\n\r\nfunction normalizeRVOL(rvolObj, opts = {}) {\r\n    const v = (rvolObj && typeof rvolObj === 'object' && Number.isFinite(Number(rvolObj.value))) ? Number(rvolObj.value) : (Number(rvolObj) || 0);\r\n    const max = (opts.max || 3);\r\n    return Math.round(mapTo0_100(v, 0, max));\r\n}\r\n\r\nfunction computeTier1Normalized(results, opts = {}) {\r\n    const weights = (M && M.WEIGHTS && M.WEIGHTS.TIER1) ? M.WEIGHTS.TIER1 : null;\r\n    const w = weights || { kyle: 0.3, vwap: 0.25, cvd: 0.25, rvol: 0.2 };\r\n    const kScore = normalizeKyleLambda(results.kyleLambda, opts.kyle);\r\n    const vScore = normalizeVWAP(results.vwapBands, opts.vwap);\r\n    const cScore = normalizeCVD(results.cvd, opts.cvd);\r\n    const rScore = normalizeRVOL(results.rvol, opts.rvol);\r\n    const composite = Math.round((kScore * w.kyle) + (vScore * w.vwap) + (cScore * w.cvd) + (rScore * w.rvol));\r\n    return { kyle: kScore, vwap: vScore, cvd: cScore, rvol: rScore, tier1Score: composite };\r\n}\r\n\r\nfunction computeVPIN(history, opts = {}) {\r\n    const lookback = opts.lookbackBars || 50;\r\n    const minSamples = opts.minSamples || 10;\r\n    if (!Array.isArray(history) || history.length < minSamples) return { valid: false, reason: 'INSUFFICIENT_DATA' };\r\n    const slice = history.slice(-lookback);\r\n    const imbalances = [];\r\n    for (const p of slice) {\r\n        const buy = toNum(p.volBuy) || toNum(p.volBuy2h) || toNum(p.vol_buy) || 0;\r\n        const sell = toNum(p.volSell) || toNum(p.volSell2h) || toNum(p.vol_sell) || 0;\r\n        const total = buy + sell;\r\n        if (total <= 0) continue;\r\n        const imb = (buy - sell) / total;\r\n        imbalances.push(Math.abs(imb));\r\n    }\r\n    if (!imbalances.length) return { valid: false, reason: 'NO_VOLUME' };\r\n    const avgAbs = imbalances.reduce((s, v) => s + v, 0) / imbalances.length;\r\n    const vp = avgAbs;\r\n    return { valid: true, value: vp, percent: vp * 100, normalized: Math.round(mapTo0_100(vp, 0, 1)) };\r\n}\r\n\r\nfunction computeHurstExponent(history, opts = {}) {\r\n    const minSamples = opts.minSamples || 50;\r\n    if (!Array.isArray(history) || history.length < minSamples) return { valid: false, reason: 'INSUFFICIENT_DATA' };\r\n    const prices = history.map(h => toNum(h.price) || toNum(h.last) || 0).filter(x => Number.isFinite(x) && x > 0);\r\n    if (prices.length < minSamples) return { valid: false, reason: 'INSUFFICIENT_PRICES' };\r\n    const N = prices.length;\r\n    const maxK = Math.floor(N / 2);\r\n    const ks = [];\r\n    const rs = [];\r\n    for (let k = 10; k <= Math.min(100, maxK); k = Math.floor(k * 1.5)) {\r\n        const segments = Math.floor(N / k);\r\n        if (segments < 2) continue;\r\n        let Rsum = 0;\r\n        for (let s = 0; s < segments; s++) {\r\n            const seg = prices.slice(s * k, (s + 1) * k);\r\n            const mean = seg.reduce((a, b) => a + b, 0) / seg.length;\r\n            const dev = seg.map(v => v - mean);\r\n            const cum = [];\r\n            let c = 0;\r\n            for (const d of dev) { c += d; cum.push(c); }\r\n            const R = Math.max(...cum) - Math.min(...cum);\r\n            const S = Math.sqrt(seg.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / seg.length) || 1e-8;\r\n            Rsum += R / S;\r\n        }\r\n        const RS = Rsum / segments;\r\n        ks.push(Math.log(k));\r\n        rs.push(Math.log(RS));\r\n    }\r\n    if (ks.length < 2) return { valid: false, reason: 'INSUFFICIENT_SCALING' };\r\n    const n = ks.length;\r\n    const meanK = ks.reduce((a, b) => a + b, 0) / n;\r\n    const meanR = rs.reduce((a, b) => a + b, 0) / n;\r\n    let num = 0, den = 0;\r\n    for (let i = 0; i < n; i++) { num += (ks[i] - meanK) * (rs[i] - meanR); den += Math.pow(ks[i] - meanK, 2); }\r\n    const slope = den === 0 ? 0 : num / den;\r\n    let hurst = slope;\r\n    if (!Number.isFinite(hurst) || hurst <= 0) hurst = 0;\r\n    hurst = Math.max(0, Math.min(1, hurst));\r\n    const interpretation = hurst > 0.55 ? 'TRENDING' : (hurst < 0.45 ? 'MEAN_REVERTING' : 'RANDOM');\r\n    return { valid: true, value: hurst, interpretation, normalized: Math.round(mapTo0_100(hurst, 0, 1)) };\r\n}\r\n\r\nfunction computeVolumeProfilePOC(history, opts = {}) {\r\n    const bins = opts.bins || 20;\r\n    if (!Array.isArray(history) || history.length === 0) return { valid: false, reason: 'INSUFFICIENT_DATA' };\r\n    const prices = history.map(h => toNum(h.price) || toNum(h.last) || 0).filter(p => Number.isFinite(p));\r\n    const vols = history.map(h => (toNum(h.volBuy) || toNum(h.volBuy2h) || 0) + (toNum(h.volSell) || toNum(h.volSell2h) || 0) || toNum(h.vol) || 0);\r\n    const minP = Math.min(...prices);\r\n    const maxP = Math.max(...prices);\r\n    if (minP === maxP) return { valid: false, reason: 'FLAT_PRICE' };\r\n    const binSize = (maxP - minP) / bins;\r\n    const profile = new Array(bins).fill(0);\r\n    for (let i = 0; i < prices.length; i++) {\r\n        const p = prices[i];\r\n        const v = vols[i] || 0;\r\n        const idx = Math.min(bins - 1, Math.max(0, Math.floor((p - minP) / binSize)));\r\n        profile[idx] += v;\r\n    }\r\n    let maxIdx = 0; let maxV = 0; let totalV = 0;\r\n    for (let i = 0; i < profile.length; i++) { totalV += profile[i]; if (profile[i] > maxV) { maxV = profile[i]; maxIdx = i; } }\r\n    const poc = minP + (maxIdx + 0.5) * binSize;\r\n    const target = totalV * 0.7;\r\n    let areaV = profile[maxIdx];\r\n    let low = maxIdx, high = maxIdx;\r\n    while (areaV < target && (low > 0 || high < bins - 1)) {\r\n        const left = (low > 0) ? profile[low - 1] : -1;\r\n        const right = (high < bins - 1) ? profile[high + 1] : -1;\r\n        if (left >= right) { if (left > 0) { low -= 1; areaV += profile[low]; } else if (right > 0) { high += 1; areaV += profile[high]; } else break; }\r\n        else { if (right > 0) { high += 1; areaV += profile[high]; } else if (left > 0) { low -= 1; areaV += profile[low]; } else break; }\r\n    }\r\n    const valueAreaLow = minP + low * binSize;\r\n    const valueAreaHigh = minP + (high + 1) * binSize;\r\n    return { valid: true, poc, valueAreaLow, valueAreaHigh, profile, totalVolume: totalV };\r\n}\r\n\r\nfunction computeDepthImbalance(snapshot, opts = {}) {\r\n    if (!snapshot) return { valid: false, reason: 'NO_SNAPSHOT' };\r\n    const bid = toNum(snapshot.bidDepth) || toNum(snapshot.bid_size) || toNum(snapshot.bids_size) || 0;\r\n    const ask = toNum(snapshot.askDepth) || toNum(snapshot.ask_size) || toNum(snapshot.asks_size) || 0;\r\n    const total = bid + ask;\r\n    if (total === 0) return { valid: false, reason: 'NO_DEPTH' };\r\n    const imb = (bid - ask) / total;\r\n    return { valid: true, value: imb, normalized: Math.round(mapTo0_100(imb, -1, 1)), className: imb > 0 ? 'text-success' : 'text-danger' };\r\n}\r\n\r\nfunction calculateSmartMoneyIndex(data) {\r\n    const a = (data && (data.analytics || data._analytics)) ? (data.analytics || data._analytics) : (data || {});\r\n    \r\n    const volBuy2h = toNum(a.volBuy2h);\r\n    const volSell2h = toNum(a.volSell2h);\r\n    const freqBuy2h = toNum(a.freqBuy2h);\r\n    const freqSell2h = toNum(a.freqSell2h);\r\n    \r\n    const totalVol = volBuy2h + volSell2h;\r\n    const totalFreq = freqBuy2h + freqSell2h;\r\n    \r\n    if (totalFreq === 0) {\r\n        const volVsAvg = toNum(a.volBuy_vs_avg_percent) || 100;\r\n        const volDur = toNum(a.volDurability2h_percent) || 50;\r\n        const smi = (volVsAvg * 0.5) + (volDur * 0.5);\r\n        return {\r\n            value: clamp(smi, 0, 200),\r\n            normalized: mapTo0_100(smi, 0, 200),\r\n            interpretation: smi > 150 ? 'WHALE' : smi > 100 ? 'MIXED' : smi > 50 ? 'RETAIL' : 'LOW',\r\n            className: smi > 150 ? 'text-success fw-bold' : smi > 100 ? 'text-warning' : 'text-muted'\r\n        };\r\n    }\r\n    \r\n    const avgVolPerTrade = safeDiv(totalVol, totalFreq, 0);\r\n    \r\n    const avgVolBuy = toNum(a.avgBuy2h);\r\n    const avgVolSell = toNum(a.avgSell2h);\r\n    const avgFreqBuy = toNum(a.avgFreqBuy2h);\r\n    const avgFreqSell = toNum(a.avgFreqSell2h);\r\n    \r\n    const histTotalVol = avgVolBuy + avgVolSell;\r\n    const histTotalFreq = avgFreqBuy + avgFreqSell;\r\n    const histAvgVolPerTrade = safeDiv(histTotalVol, histTotalFreq, avgVolPerTrade);\r\n    \r\n    const smi = safeDiv(avgVolPerTrade, histAvgVolPerTrade, 1) * 100;\r\n    \r\n    return {\r\n        value: clamp(smi, 0, 500),\r\n        normalized: mapTo0_100(smi, 0, 200),\r\n        interpretation: smi > 150 ? 'WHALE' : smi > 100 ? 'MIXED' : smi > 50 ? 'RETAIL' : 'LOW',\r\n        className: smi > 150 ? 'text-success fw-bold' : smi > 100 ? 'text-warning' : 'text-muted'\r\n    };\r\n}\r\n\r\nfunction calculateTradeIntensity(data) {\r\n    const a = (data && (data.analytics || data._analytics)) ? (data.analytics || data._analytics) : (data || {});\r\n    \r\n    const volBuy2h = toNum(a.volBuy2h);\r\n    const volSell2h = toNum(a.volSell2h);\r\n    const avgVolBuy = Math.max(toNum(a.avgBuy2h), 1);\r\n    const avgVolSell = Math.max(toNum(a.avgSell2h), 1);\r\n    \r\n    const freqBuy2h = toNum(a.freqBuy2h);\r\n    const freqSell2h = toNum(a.freqSell2h);\r\n    const avgFreqBuy = toNum(a.avgFreqBuy2h);\r\n    const avgFreqSell = toNum(a.avgFreqSell2h);\r\n    \r\n    const volIntensity = (safeDiv(volBuy2h, avgVolBuy, 1) + safeDiv(volSell2h, avgVolSell, 1)) / 2;\r\n    \r\n    let freqIntensity = 1;\r\n    if (avgFreqBuy > 0 || avgFreqSell > 0) {\r\n        freqIntensity = (safeDiv(freqBuy2h, Math.max(avgFreqBuy, 1), 1) + \r\n                        safeDiv(freqSell2h, Math.max(avgFreqSell, 1), 1)) / 2;\r\n    }\r\n    \r\n    const intensity = ((volIntensity + freqIntensity) / 2) * 50;\r\n    \r\n    return {\r\n        value: clamp(intensity, 0, 200),\r\n        normalized: mapTo0_100(intensity, 0, 150),\r\n        level: intensity > 100 ? 'EXTREME' : intensity > 70 ? 'HIGH' : intensity > 40 ? 'MEDIUM' : 'LOW',\r\n        className: intensity > 70 ? 'text-success fw-bold' : intensity > 40 ? 'text-warning' : 'text-muted'\r\n    };\r\n}\r\n\r\nfunction calculateAccumulationScore(data) {\r\n    const a = (data && (data.analytics || data._analytics)) ? (data.analytics || data._analytics) : (data || {});\r\n    \r\n    const volDur2h = toNum(a.volDurability2h_percent) || 50;\r\n    const volDur24h = toNum(a.volDurability24h_percent) || 50;\r\n    const volVsAvg = toNum(a.volBuy_vs_avg_percent) || 100;\r\n    \r\n    const buyDominance = (volDur2h - 50) / 50;\r\n    const aboveAvg = clamp((volVsAvg - 100) / 100, -1, 1);\r\n    const persistence = Math.abs(volDur24h - 50) > 10 && \r\n                       Math.sign(volDur24h - 50) === Math.sign(volDur2h - 50) ? 1 : 0.5;\r\n    \r\n    const score = 50 + (buyDominance * 25) + (aboveAvg * 15) + (persistence * 10);\r\n    \r\n    return {\r\n        value: clamp(score, 0, 100),\r\n        normalized: clamp(score, 0, 100),\r\n        interpretation: score > 70 ? 'ACCUMULATION' : score < 30 ? 'DISTRIBUTION' : 'NEUTRAL',\r\n        className: score > 70 ? 'text-success' : score < 30 ? 'text-danger' : 'text-warning'\r\n    };\r\n}\r\n\r\nfunction calculateMomentumDivergence(data) {\r\n    const a = (data && (data.analytics || data._analytics)) ? (data.analytics || data._analytics) : (data || {});\r\n    const priceChange = toNum(data.percent_change);\r\n    \r\n    const volDur = toNum(a.volDurability2h_percent) || 50;\r\n    const flowBias = (volDur - 50) / 50;\r\n    const priceDir = priceChange > 0.5 ? 1 : priceChange < -0.5 ? -1 : 0;\r\n    \r\n    const divergence = flowBias - (priceDir * 0.5);\r\n    \r\n    let interpretation = 'NEUTRAL';\r\n    let className = 'text-muted';\r\n    \r\n    if (divergence > 0.3 && priceChange < 0) {\r\n        interpretation = 'BULL DIV';\r\n        className = 'text-success fw-bold';\r\n    } else if (divergence < -0.3 && priceChange > 0) {\r\n        interpretation = 'BEAR DIV';\r\n        className = 'text-danger fw-bold';\r\n    } else if (divergence > 0.2) {\r\n        interpretation = 'BULLISH';\r\n        className = 'text-success';\r\n    } else if (divergence < -0.2) {\r\n        interpretation = 'BEARISH';\r\n        className = 'text-danger';\r\n    }\r\n    \r\n    return {\r\n        value: divergence,\r\n        normalized: mapToNeg100_100(divergence, -1, 1),\r\n        interpretation,\r\n        priceChange,\r\n        flowBias,\r\n        className\r\n    };\r\n}\r\n\r\nfunction calculateWhaleActivity(data) {\r\n    const a = (data && (data.analytics || data._analytics)) ? (data.analytics || data._analytics) : (data || {});\r\n    \r\n    const smi = calculateSmartMoneyIndex(data);\r\n    const volVsAvg = toNum(a.volBuy_vs_avg_percent) || 100;\r\n    const volDur = toNum(a.volDurability2h_percent) || 50;\r\n    \r\n    let whaleScore = 0;\r\n    whaleScore += mapTo0_100(smi.value, 50, 200) * 0.4;\r\n    whaleScore += mapTo0_100(volVsAvg, 50, 300) * 0.35;\r\n    whaleScore += Math.abs(volDur - 50) * 0.5;\r\n    \r\n    return {\r\n        value: clamp(whaleScore, 0, 100),\r\n        normalized: clamp(whaleScore, 0, 100),\r\n        level: whaleScore > 70 ? 'HIGH' : whaleScore > 40 ? 'MEDIUM' : 'LOW',\r\n        className: whaleScore > 70 ? 'text-info fw-bold' : whaleScore > 40 ? 'text-info' : 'text-muted'\r\n    };\r\n}\r\n\r\nfunction calculateRetailInstitutionalRatio(data) {\r\n    const intensity = calculateTradeIntensity(data);\r\n    const whale = calculateWhaleActivity(data);\r\n    const ratio = intensity.value > 0 ? safeDiv(whale.value, intensity.value, 1) * 100 : 100;\r\n    const clampedRatio = clamp(ratio, 0, 300);\r\n    \r\n    let type = 'MIXED';\r\n    let className = 'text-muted';\r\n    \r\n    if (clampedRatio > 150) {\r\n        type = 'INST';\r\n        className = 'text-info fw-bold';\r\n    } else if (clampedRatio > 100) {\r\n        type = 'INST+';\r\n        className = 'text-info';\r\n    } else if (clampedRatio < 60) {\r\n        type = 'RETAIL';\r\n        className = 'text-warning';\r\n    } else if (clampedRatio < 80) {\r\n        type = 'RETAIL+';\r\n        className = 'text-warning';\r\n    }\r\n    \r\n    return {\r\n        value: clampedRatio,\r\n        normalized: mapTo0_100(clampedRatio, 0, 200),\r\n        type,\r\n        className\r\n    };\r\n}\r\n\r\nfunction calculatePressureIndex(data) {\r\n    const a = (data && (data.analytics || data._analytics)) ? (data.analytics || data._analytics) : (data || {});\r\n    \r\n    const volDur2h = toNum(a.volDurability2h_percent) || 50;\r\n    const freqDur = toNum(a.freqRatio2h_percent) || 50;\r\n    const imbalance = toNum(a.volImbalance2h) || 0;\r\n    \r\n    let pressure = 0;\r\n    pressure += (volDur2h - 50) * 1.0;\r\n    pressure += (freqDur - 50) * 0.5;\r\n    pressure += imbalance * 30;\r\n    \r\n    return {\r\n        value: clamp(pressure, -100, 100),\r\n        normalized: mapTo0_100(pressure, -100, 100),\r\n        direction: pressure > 20 ? 'BUY' : pressure < -20 ? 'SELL' : 'NEUTRAL',\r\n        className: pressure > 30 ? 'text-success' : pressure < -30 ? 'text-danger' : 'text-muted'\r\n    };\r\n}\r\n\r\nfunction calculateOrderFlowImbalance(data) {\r\n    const a = (data && (data.analytics || data._analytics)) ? (data.analytics || data._analytics) : (data || {});\r\n    const volBuy = toNum(a.volBuy2h) || 0;\r\n    const volSell = toNum(a.volSell2h) || 0;\r\n    const freqBuy = toNum(a.freqBuy2h) || 0;\r\n    const freqSell = toNum(a.freqSell2h) || 0;\r\n\r\n    const volDen = volBuy + volSell;\r\n    const freqDen = freqBuy + freqSell;\r\n\r\n    const volImb = volDen > 0 ? (volBuy - volSell) / volDen : 0;\r\n    const freqImb = freqDen > 0 ? (freqBuy - freqSell) / freqDen : 0;\r\n\r\n    const combined = (volImb * 0.7) + (freqImb * 0.3);\r\n\r\n    const interp = combined > 0.05 ? 'BUY' : combined < -0.05 ? 'SELL' : 'NEUTRAL';\r\n    const cls = combined > 0.05 ? 'text-success' : combined < -0.05 ? 'text-danger' : 'text-muted';\r\n\r\n    return {\r\n        value: combined,\r\n        normalized: mapToNeg100_100(combined, -1, 1),\r\n        interpretation: interp,\r\n        volImbalance: volImb,\r\n        freqImbalance: freqImb,\r\n        className: cls\r\n    };\r\n}\r\n\r\nfunction calculateVolumeProfile(data, bins = 50, valueAreaPercent = 0.70) {\r\n    const history = data && Array.isArray(data._history) ? data._history : (data && Array.isArray(data.history) ? data.history : []);\r\n    if (!history || history.length === 0) return { pocPrice: 0, pocBin: 0, valueAreaLow: 0, valueAreaHigh: 0, totalVolume: 0, valueAreaPercent: 0 };\r\n\r\n    const points = history.map(p => {\r\n        const price = toNum(p.price) || toNum(p.last) || toNum(p.close) || toNum(p.high) || toNum(p.low) || 0;\r\n        const vol = toNum(p.vol) || toNum(p.volume) || toNum(p.size) || toNum(p.qty) || toNum(p.buy) + toNum(p.sell) || 0;\r\n        return { price, vol };\r\n    }).filter(pt => pt.price > 0 && pt.vol > 0);\r\n\r\n    if (!points.length) return { pocPrice: 0, pocBin: 0, valueAreaLow: 0, valueAreaHigh: 0, totalVolume: 0, valueAreaPercent: 0 };\r\n\r\n    let minP = Infinity, maxP = -Infinity, totalVol = 0;\r\n    for (const pt of points) { if (pt.price < minP) minP = pt.price; if (pt.price > maxP) maxP = pt.price; totalVol += pt.vol; }\r\n    if (!Number.isFinite(minP) || !Number.isFinite(maxP) || minP >= maxP) {\r\n        const avgPrice = points.reduce((s, p) => s + p.price, 0) / points.length;\r\n        return { pocPrice: avgPrice, pocBin: 0, valueAreaLow: avgPrice, valueAreaHigh: avgPrice, totalVolume: totalVol, valueAreaPercent: 1 };\r\n    }\r\n\r\n    const binCount = Math.max(1, Math.floor(bins));\r\n    const width = (maxP - minP) / binCount;\r\n    const buckets = new Array(binCount).fill(0);\r\n    for (const pt of points) {\r\n        let idx = Math.floor((pt.price - minP) / width);\r\n        if (idx < 0) idx = 0;\r\n        if (idx >= binCount) idx = binCount - 1;\r\n        buckets[idx] += pt.vol;\r\n    }\r\n\r\n    let poc = 0, maxVol = -1;\r\n    for (let i = 0; i < buckets.length; i++) { if (buckets[i] > maxVol) { maxVol = buckets[i]; poc = i; } }\r\n\r\n    const target = totalVol * Math.max(0.01, Math.min(0.99, valueAreaPercent));\r\n    let left = poc; let right = poc; let collected = buckets[poc];\r\n    while (collected < target) {\r\n        const leftVol = (left - 1) >= 0 ? buckets[left - 1] : -1;\r\n        const rightVol = (right + 1) < buckets.length ? buckets[right + 1] : -1;\r\n        if (leftVol <= 0 && rightVol <= 0) break;\r\n        if (rightVol > leftVol) {\r\n            right++; collected += buckets[right];\r\n        } else { left--; collected += buckets[left]; }\r\n    }\r\n\r\n    const pocPrice = minP + (poc + 0.5) * width;\r\n    const valueAreaLow = minP + left * width;\r\n    const valueAreaHigh = minP + (right + 1) * width;\r\n    const actualValueAreaPercent = totalVol > 0 ? (collected / totalVol) : 0;\r\n\r\n    return {\r\n        pocBin: poc,\r\n        pocPrice: Number.isFinite(pocPrice) ? pocPrice : 0,\r\n        valueAreaLow: Number.isFinite(valueAreaLow) ? valueAreaLow : 0,\r\n        valueAreaHigh: Number.isFinite(valueAreaHigh) ? valueAreaHigh : 0,\r\n        totalVolume: totalVol,\r\n        valueAreaPercent: actualValueAreaPercent,\r\n        buckets,\r\n        binWidth: width,\r\n        minPrice: minP,\r\n        maxPrice: maxP\r\n    };\r\n}\r\n\r\nfunction detectLiquiditySweep(data) {\r\n    const a = (data && (data.analytics || data._analytics)) ? (data.analytics || data._analytics) : {};\r\n    const history = Array.isArray(data && data._history) ? data._history : (Array.isArray(data && data.history) ? data.history : []);\r\n    const recent = history.length ? history[history.length - 1] : null;\r\n\r\n    const getVolFields = (pt) => {\r\n        if (!pt) return { buy: 0, sell: 0, total: 0 };\r\n        const buy = toNum(pt.buy) || toNum(pt.volBuy) || toNum(pt.vol_buy) || toNum(pt.volBuy2h) || 0;\r\n        const sell = toNum(pt.sell) || toNum(pt.volSell) || toNum(pt.vol_sell) || toNum(pt.volSell2h) || 0;\r\n        return { buy, sell, total: buy + sell };\r\n    };\r\n\r\n    const windowSize = Math.min(10, Math.max(3, Math.floor(history.length / 6)));\r\n    const recentWindow = history.slice(Math.max(0, history.length - windowSize), history.length - 1);\r\n    let sumBuy = 0, sumSell = 0, count = 0;\r\n    for (const p of recentWindow) {\r\n        const vf = getVolFields(p);\r\n        sumBuy += vf.buy; sumSell += vf.sell; count++;\r\n    }\r\n    const avgBuy = count > 0 ? (sumBuy / count) : (toNum(a.avgBuy2h) || 1);\r\n    const avgSell = count > 0 ? (sumSell / count) : (toNum(a.avgSell2h) || 1);\r\n\r\n    const recentV = getVolFields(recent);\r\n    const buyRatio = avgBuy > 0 ? (recentV.buy / avgBuy) : 0;\r\n    const sellRatio = avgSell > 0 ? (recentV.sell / avgSell) : 0;\r\n\r\n    const priceNow = toNum(recent && (recent.price || recent.last || recent.close)) || toNum(data.last) || 0;\r\n    const prevPrice = toNum(history.length >= 2 ? history[history.length - 2].price || history[history.length - 2].last : null) || 0;\r\n    const pricePct = (prevPrice > 0 && priceNow > 0) ? ((priceNow - prevPrice) / prevPrice) * 100 : 0;\r\n\r\n    const RATIO_SWEEP = 3.0;\r\n    const PRICE_MOVE_PCT = 0.3;\r\n\r\n    let side = 'NONE';\r\n    let confidence = 0;\r\n\r\n    if (buyRatio >= RATIO_SWEEP && pricePct >= PRICE_MOVE_PCT) {\r\n        side = 'BUY';\r\n        confidence = Math.min(100, Math.round(((buyRatio - RATIO_SWEEP) / RATIO_SWEEP) * 50 + Math.min(50, pricePct * 10)));\r\n    } else if (sellRatio >= RATIO_SWEEP && pricePct <= -PRICE_MOVE_PCT) {\r\n        side = 'SELL';\r\n        confidence = Math.min(100, Math.round(((sellRatio - RATIO_SWEEP) / RATIO_SWEEP) * 50 + Math.min(50, Math.abs(pricePct) * 10)));\r\n    }\r\n\r\n    const totalAvg = Math.max(1, avgBuy + avgSell);\r\n    const totalRecent = Math.max(1, recentV.total);\r\n    const totalSpikeRatio = totalRecent / totalAvg;\r\n    if (totalSpikeRatio > 5 && confidence < 30) {\r\n        confidence = Math.min(100, confidence + Math.round((totalSpikeRatio - 5) * 5));\r\n        if (recentV.buy > recentV.sell) side = 'BUY'; else if (recentV.sell > recentV.buy) side = 'SELL';\r\n    }\r\n\r\n    return {\r\n        sweep: side !== 'NONE' && confidence > 0,\r\n        side,\r\n        confidence,\r\n        buyRatio: Number.isFinite(buyRatio) ? buyRatio : 0,\r\n        sellRatio: Number.isFinite(sellRatio) ? sellRatio : 0,\r\n        pricePct: Number.isFinite(pricePct) ? pricePct : 0,\r\n        totalSpikeRatio: Number.isFinite(totalSpikeRatio) ? totalSpikeRatio : 0\r\n    };\r\n}\r\n\r\nfunction calculateTrendStrength(data) {\r\n    const a = (data && (data.analytics || data._analytics)) ? (data.analytics || data._analytics) : (data || {});\r\n    \r\n    const volDur2h = toNum(a.volDurability2h_percent) || 50;\r\n    const volDur24h = toNum(a.volDurability24h_percent) || 50;\r\n    const intensity = calculateTradeIntensity(data);\r\n    \r\n    const biasConsistency = 1 - Math.abs((volDur2h - 50) / 50 - (volDur24h - 50) / 50);\r\n    const biasStrength = Math.abs(volDur2h - 50) / 50;\r\n    const volumeConfirmation = intensity.normalized / 100;\r\n    \r\n    const strength = (biasStrength * 0.5 + biasConsistency * 0.3 + volumeConfirmation * 0.2) * 100;\r\n    const direction = volDur2h > 55 ? 'UP' : volDur2h < 45 ? 'DOWN' : 'SIDEWAYS';\r\n    \r\n    return {\r\n        value: clamp(strength, 0, 100),\r\n        normalized: clamp(strength, 0, 100),\r\n        direction,\r\n        level: strength > 70 ? 'STRONG' : strength > 40 ? 'MODERATE' : 'WEAK',\r\n        className: strength > 60 ? 'text-success' : strength > 30 ? 'text-warning' : 'text-muted'\r\n    };\r\n}\r\n\r\nfunction calculateBreakoutProbability(data) {\r\n    const a = (data && (data.analytics || data._analytics)) ? (data.analytics || data._analytics) : (data || {});\r\n    const history = data._history || [];\r\n    \r\n    const atr = computeATR(history, 14);\r\n    const avgPrice = history.length > 0 ? \r\n        history.slice(-14).reduce((s, h) => s + toNum(h.last), 0) / Math.min(history.length, 14) : \r\n        toNum(data.last);\r\n    \r\n    const atrPercent = safeDiv(atr, avgPrice, 0.05) * 100;\r\n    const compressionScore = clamp(100 - (atrPercent * 20), 0, 100);\r\n    \r\n    const intensity = calculateTradeIntensity(data);\r\n    const intensityScore = intensity.normalized;\r\n    \r\n    const imbalance = Math.abs(toNum(a.volImbalance2h) || 0);\r\n    const imbalanceScore = mapTo0_100(imbalance, 0, 0.5);\r\n    \r\n    const pricePos = toNum(a.pricePosition) || 50;\r\n    const nearExtreme = Math.max(pricePos, 100 - pricePos);\r\n    const extremeScore = mapTo0_100(nearExtreme, 50, 100);\r\n    \r\n    const prob = (compressionScore * 0.3) + (intensityScore * 0.25) + \r\n                (imbalanceScore * 0.25) + (extremeScore * 0.2);\r\n    \r\n    const level = prob > 70 ? 'HIGH' : prob > 50 ? 'MEDIUM' : 'LOW';\r\n    \r\n    return {\r\n        value: clamp(prob, 0, 100),\r\n        normalized: clamp(prob, 0, 100),\r\n        level,\r\n        confidence: level,\r\n        direction: pricePos > 60 ? 'UP' : pricePos < 40 ? 'DOWN' : 'UNKNOWN',\r\n        className: prob > 70 ? 'text-warning fw-bold' : prob > 50 ? 'text-warning' : 'text-muted',\r\n        factors: { compression: compressionScore, intensity: intensityScore, imbalance: imbalanceScore, extreme: extremeScore }\r\n    };\r\n}\r\n\r\nfunction calculateLiquidityStressIndex(data) {\r\n    const a = (data && (data.analytics || data._analytics)) ? (data.analytics || data._analytics) : (data || {});\r\n    \r\n    const avgTradeValue = toNum(a.liquidity_avg_trade_value) || 0;\r\n    const totalVolFiat = toNum(data.total_vol_fiat) || toNum(a.totalVolFiat) || 0;\r\n    const totalFreq = (toNum(a.freqBuy2h) || 0) + (toNum(a.freqSell2h) || 0);\r\n    \r\n    let lsi = 50;\r\n    if (avgTradeValue > 0) {\r\n        const baseline = 1000;\r\n        lsi = mapTo0_100(avgTradeValue, baseline * 0.1, baseline * 10);\r\n    }\r\n    if (totalFreq > 0 && totalFreq < 100) {\r\n        lsi += (100 - totalFreq) * 0.2;\r\n    }\r\n    lsi = clamp(lsi, 0, 100);\r\n    \r\n    return {\r\n        value: lsi,\r\n        normalized: lsi,\r\n        level: lsi > 70 ? 'ILLIQUID' : lsi > 40 ? 'MODERATE' : 'LIQUID',\r\n        className: lsi > 70 ? 'text-danger' : lsi > 40 ? 'text-warning' : 'text-success',\r\n        avgTradeValue\r\n    };\r\n}\r\n\r\nfunction classifyMarketMode(data) {\r\n    const a = (data && (data.analytics || data._analytics)) ? (data.analytics || data._analytics) : (data || {});\r\n    const history = data._history || [];\r\n    \r\n    const atr = computeATR(history, 14);\r\n    const avgPrice = history.length > 0 ?\r\n        history.slice(-14).reduce((s, h) => s + toNum(h.last), 0) / Math.min(history.length, 14) :\r\n        toNum(data.last);\r\n    \r\n    const atrPercent = safeDiv(atr, avgPrice, 0.02) * 100;\r\n    const volDur2h = toNum(a.volDurability2h_percent) || 50;\r\n    const pricePos = toNum(a.pricePosition) || 50;\r\n    \r\n    const isLowVol = atrPercent < 1.5;\r\n    const isHighVol = atrPercent > 4;\r\n    \r\n    const hasBias = Math.abs(volDur2h - 50) > 15;\r\n    const biasDirection = volDur2h > 50 ? 'UP' : 'DOWN';\r\n    \r\n    let mode = 'RANGE';\r\n    let confidence = 50;\r\n    \r\n    if (isLowVol && !hasBias) {\r\n        mode = 'SQUEEZE';\r\n        confidence = 70 + (1.5 - atrPercent) * 10;\r\n    } else if (isHighVol && hasBias) {\r\n        mode = 'TREND';\r\n        confidence = 60 + Math.abs(volDur2h - 50);\r\n    } else if (hasBias && pricePos > 70) {\r\n        mode = 'TREND_UP';\r\n        confidence = 55 + (pricePos - 70);\r\n    } else if (hasBias && pricePos < 30) {\r\n        mode = 'TREND_DOWN';\r\n        confidence = 55 + (30 - pricePos);\r\n    } else {\r\n        mode = 'RANGE';\r\n        confidence = 50 + (50 - Math.abs(volDur2h - 50));\r\n    }\r\n    \r\n    return {\r\n        mode,\r\n        confidence: clamp(confidence, 0, 100),\r\n        atrPercent,\r\n        bias: hasBias ? biasDirection : 'NONE',\r\n        className: mode.includes('TREND') ? 'text-success' : mode === 'SQUEEZE' ? 'text-warning' : 'text-muted'\r\n    };\r\n}\r\n\r\nfunction detectRegimeTransition(data) {\r\n    const a = (data && (data.analytics || data._analytics)) ? (data.analytics || data._analytics) : (data || {});\r\n    const history = Array.isArray(data && data._history) ? data._history : (Array.isArray(data && data.history) ? data.history : []);\r\n\r\n    const atr = computeATR(history, 14);\r\n    const avgPrice = history.length > 0 ? history.slice(-14).reduce((s, h) => s + toNum(h.last), 0) / Math.min(history.length, 14) : toNum(data.last);\r\n    const atrPct = safeDiv(atr, avgPrice, 0) * 100;\r\n\r\n    const volDur2h = toNum(a.volDurability2h_percent) || 50;\r\n    const volDur24h = toNum(a.volDurability24h_percent) || 50;\r\n\r\n    let regime = 'UNKNOWN';\r\n    let confidence = 30;\r\n\r\n    const lowVol = atrPct < 1.5;\r\n    const highVol = atrPct > 4;\r\n    const durDelta = volDur2h - volDur24h;\r\n\r\n    if (lowVol && durDelta > 5) {\r\n        regime = 'ACCUMULATION';\r\n        confidence = 50 + Math.min(50, durDelta * 2 + (1.5 - atrPct) * 10);\r\n    } else if (highVol && durDelta < -5) {\r\n        regime = 'DISTRIBUTION';\r\n        confidence = 50 + Math.min(50, Math.abs(durDelta) * 2 + (atrPct - 4) * 5);\r\n    } else if (highVol && Math.abs(durDelta) > 8) {\r\n        regime = durDelta > 0 ? 'TREND_UP' : 'TREND_DOWN';\r\n        confidence = 50 + Math.min(50, Math.abs(durDelta) * 2 + (atrPct - 4) * 5);\r\n    } else if (lowVol && Math.abs(durDelta) <= 5) {\r\n        regime = 'RANGE';\r\n        confidence = 40 + Math.min(40, (1.5 - atrPct) * 10);\r\n    } else {\r\n        const atrShort = computeATR(history.slice(-6), 6) || 0;\r\n        const atrTrend = atrShort > atr ? 1 : (atrShort < atr ? -1 : 0);\r\n        if (atrTrend > 0 && Math.abs(durDelta) > 3) {\r\n            regime = durDelta > 0 ? 'EMERGING_UP' : 'EMERGING_DOWN';\r\n            confidence = 35 + Math.min(50, Math.abs(durDelta) * 3);\r\n        } else {\r\n            regime = 'MIXED';\r\n            confidence = 30;\r\n        }\r\n    }\r\n\r\n    return {\r\n        regime,\r\n        confidence: clamp(Math.round(confidence), 0, 100),\r\n        atrPercent: Number.isFinite(atrPct) ? atrPct : 0,\r\n        volDur2h,\r\n        volDur24h,\r\n        volDurDelta: durDelta\r\n    };\r\n}\r\n\r\nfunction generateSmartSignal(data) {\r\n    const accum = calculateAccumulationScore(data);\r\n    const pressure = calculatePressureIndex(data);\r\n    const trend = calculateTrendStrength(data);\r\n    const divergence = calculateMomentumDivergence(data);\r\n    const whale = calculateWhaleActivity(data);\r\n    const intensity = calculateTradeIntensity(data);\r\n    \r\n    let score = 0;\r\n    score += (accum.value - 50) * 0.8;\r\n    score += pressure.value * 0.3;\r\n    if (divergence.interpretation === 'BULL DIV') score += 15;\r\n    if (divergence.interpretation === 'BEAR DIV') score -= 15;\r\n    if (whale.value > 70 && accum.value > 55) score += 10;\r\n    if (whale.value > 70 && accum.value < 45) score -= 10;\r\n    if (intensity.value > 70 && pressure.value > 20) score += 10;\r\n    if (intensity.value > 70 && pressure.value < -20) score -= 10;\r\n    \r\n    let signal = 'HOLD';\r\n    let className = 'recommendation-hold';\r\n    const confidence = Math.min(Math.abs(score), 100);\r\n    \r\n    if (score > 25) {\r\n        signal = 'BUY';\r\n        className = 'recommendation-buy';\r\n    } else if (score < -25) {\r\n        signal = 'SELL';\r\n        className = 'recommendation-sell';\r\n    }\r\n    \r\n    return {\r\n        signal,\r\n        confidence: Math.round(confidence),\r\n        score: Math.round(score),\r\n        className\r\n    };\r\n}\r\n\r\nfunction calculateMultiTimeframeConfluence(data, timeframes = ['120m','30m','15m','5m','1m'], weights = null) {\r\n    const defaultWeights = { '120m': 0.30, '30m': 0.25, '15m': 0.20, '5m': 0.15, '1m': 0.10 };\r\n    const w = weights || defaultWeights;\r\n\r\n    const history = Array.isArray(data && data._history) ? data._history : (Array.isArray(data && data.history) ? data.history : []);\r\n    let pricePos = 50;\r\n    try {\r\n        if (data && data.analytics && Number.isFinite(Number(data.analytics.pricePosition))) {\r\n            pricePos = Number(data.analytics.pricePosition);\r\n        } else if (history && history.length) {\r\n            const last = toNum(history[history.length - 1].last) || toNum(data.last) || 0;\r\n            let minP = Infinity, maxP = -Infinity;\r\n            for (let i = Math.max(0, history.length - 120); i < history.length; i++) {\r\n                const p = history[i];\r\n                const pr = toNum(p.price) || toNum(p.last) || toNum(p.close) || 0;\r\n                if (pr > 0) { if (pr < minP) minP = pr; if (pr > maxP) maxP = pr; }\r\n            }\r\n            if (Number.isFinite(minP) && Number.isFinite(maxP) && maxP > minP && last > 0) {\r\n                pricePos = Math.round(((last - minP) / (maxP - minP)) * 100);\r\n            }\r\n        } else if (data && data.last && data.high && data.low) {\r\n            const last = toNum(data.last), high = toNum(data.high), low = toNum(data.low);\r\n            if (high > low) pricePos = Math.round(((last - low) / (high - low)) * 100);\r\n        }\r\n    } catch (e) { pricePos = 50; }\r\n\r\n    const results = [];\r\n    let agg = 0; let totalWeight = 0;\r\n\r\n    for (const tf of timeframes) {\r\n        try {\r\n            let rec = null;\r\n            if (typeof calculateRecommendation === 'function') {\r\n                rec = calculateRecommendation(data, pricePos, tf, false);\r\n            }\r\n            if (!rec) {\r\n                const p = calculatePressureIndex(data);\r\n                const score = (p.direction === 'BUY') ? 1 : (p.direction === 'SELL') ? -1 : 0;\r\n                rec = { recommendation: score > 0 ? 'BUY' : score < 0 ? 'SELL' : 'HOLD', confidence: Math.min(100, Math.round(Math.abs(p.value))) };\r\n            }\r\n\r\n            const conf = Math.max(0, Math.min(100, Number(rec.confidence) || 0));\r\n            const sign = rec.recommendation === 'BUY' ? 1 : (rec.recommendation === 'SELL' ? -1 : 0);\r\n            const wt = (w && w[tf]) ? w[tf] : (1 / timeframes.length);\r\n            const contrib = sign * (conf / 100) * wt;\r\n            agg += contrib; totalWeight += wt;\r\n            results.push({ timeframe: tf, rec: rec.recommendation || 'HOLD', confidence: conf, weight: wt, contrib });\r\n        } catch (e) {\r\n            results.push({ timeframe: tf, rec: 'HOLD', confidence: 0, weight: (w && w[tf]) ? w[tf] : (1 / timeframes.length), contrib: 0 });\r\n        }\r\n    }\r\n\r\n    const normalized = totalWeight > 0 ? (agg / totalWeight) : 0;\r\n    const confluencePercent = Math.round(Math.abs(normalized) * 100);\r\n    const consensus = normalized > 0.25 ? 'BUY' : (normalized < -0.25 ? 'SELL' : 'MIXED');\r\n\r\n    return {\r\n        consensus,\r\n        score: normalized,\r\n        confluence: confluencePercent,\r\n        breakdown: results\r\n    };\r\n}\r\n\r\nfunction computeAllSmartMetrics(data) {\r\n    return {\r\n        ofi: calculateOrderFlowImbalance(data),\r\n        volumeProfile: calculateVolumeProfile(data, 50, 0.70),\r\n        liquiditySweep: detectLiquiditySweep(data),\r\n        regimeTransition: detectRegimeTransition(data),\r\n        multiTfConfluence: calculateMultiTimeframeConfluence(data),\r\n        smi: calculateSmartMoneyIndex(data),\r\n        intensity: calculateTradeIntensity(data),\r\n        divergence: calculateMomentumDivergence(data),\r\n        accumScore: calculateAccumulationScore(data),\r\n        whale: calculateWhaleActivity(data),\r\n        riRatio: calculateRetailInstitutionalRatio(data),\r\n        pressure: calculatePressureIndex(data),\r\n        trendStrength: calculateTrendStrength(data),\r\n        breakout: calculateBreakoutProbability(data),\r\n        lsi: calculateLiquidityStressIndex(data),\r\n        marketMode: classifyMarketMode(data),\r\n        smartSignal: generateSmartSignal(data)\r\n    };\r\n}\r\n\r\n// Build AnalyticsCore object and exports\r\nconst AnalyticsCore = {\r\n    safeDiv,\r\n    toNum,\r\n    clamp,\r\n    normalizeMetric,\r\n    mapTo0_100,\r\n    mapToNeg100_100,\r\n    meanStd,\r\n    zScore,\r\n    safeZScore,\r\n    percentile,\r\n    computeATR,\r\n    calculateVolRatio,\r\n    calculateVolDurability,\r\n    calculateSmartMoneyIndex,\r\n    calculateTradeIntensity,\r\n    calculateMomentumDivergence,\r\n    calculateAccumulationScore,\r\n    calculateWhaleActivity,\r\n    calculateRetailInstitutionalRatio,\r\n    calculatePressureIndex,\r\n    calculateTrendStrength,\r\n    generateSmartSignal,\r\n    calculateOrderFlowImbalance,\r\n    calculateVolumeProfile,\r\n    detectLiquiditySweep,\r\n    calculateBreakoutProbability,\r\n    calculateLiquidityStressIndex,\r\n    classifyMarketMode,\r\n    detectRegimeTransition,\r\n    computeAllSmartMetrics,\r\n    computeKyleLambda,\r\n    computeVWAPBands,\r\n    computeCVD,\r\n    computeRVOL,\r\n    normalizeKyleLambda,\r\n    normalizeVWAP,\r\n    normalizeCVD,\r\n    normalizeRVOL,\r\n    computeTier1Normalized,\r\n    computeVPIN,\r\n    computeHurstExponent,\r\n    computeVolumeProfilePOC,\r\n    computeDepthImbalance\r\n};\r\n\r\nexport default AnalyticsCore;\r\nexport { AnalyticsCore,\r\n    safeDiv, toNum, clamp, normalizeMetric, mapTo0_100, mapToNeg100_100,\r\n    meanStd, zScore, safeZScore, percentile, computeATR,\r\n    calculateVolRatio, calculateVolDurability,\r\n    calculateSmartMoneyIndex, calculateTradeIntensity, calculateMomentumDivergence, calculateAccumulationScore, calculateWhaleActivity, calculateRetailInstitutionalRatio, calculatePressureIndex, calculateTrendStrength, generateSmartSignal, calculateOrderFlowImbalance, calculateVolumeProfile, detectLiquiditySweep, calculateBreakoutProbability, calculateLiquidityStressIndex, classifyMarketMode, detectRegimeTransition, computeAllSmartMetrics,\r\n    computeKyleLambda, computeVWAPBands, computeCVD, computeRVOL, normalizeKyleLambda, normalizeVWAP, normalizeCVD, normalizeRVOL, computeTier1Normalized, computeVPIN, computeHurstExponent, computeVolumeProfilePOC, computeDepthImbalance };\r\n"],"names":["M","globalThis","METRICS","safeDiv","a","b","fallback","na","Number","nb","isFinite","toNum","v","s","String","replace","n","clamp","min","max","Math","normalizeMetric","value","fromMin","fromMax","toMin","toMax","mapTo0_100","mapToNeg100_100","meanStd","arr","length","mean","std","nums","filter","x","reduce","variance","acc","pow","sqrt","zScore","safeZScore","m","percentile","p","sorted","sort","idx","floor","computeATR","history","period","trs","i","curr","prev","high","last","low","prevClose","close","tr","abs","push","lookback","slice","calculateVolRatio","buy","sell","numBuy","numSell","calculateVolDurability","total","computeKyleLambda","opts","lookbackPeriods","minSamples","smoothing","smoothingWindow","valid","reason","lambdas","cur","p0","price","p1","vol0","volBuy2h","volSell2h","vol","dp","dv","avg","smoothWindow","smoothVals","smooth","rawMean","normalized","interpretation","className","computeVWAPBands","stdMultiplier","adaptive","adaptiveMultiplier","minM","minMultiplier","maxM","maxMultiplier","num","den","prices","vwap","varNum","pv","mult","upper","lower","position","deviationPct","signal","upperBand","lowerBand","multiplier","currentPosition","computeCVD","windowOpt","window","normalization","normalizationMethod","smoothingPeriod","cvd","totalVol","vol_buy","vol_sell","absNorm","trend","strength","computeRVOL","baselinePeriods","minSamplesRequired","vols","baseline","current","significance","normalizeKyleLambda","input","val","score","round","normalizeVWAP","vwapBands","dev","minPercent","maxPercent","normalizeCVD","cvdObj","normalizeRVOL","rvolObj","computeTier1Normalized","results","w","WEIGHTS","TIER1","kyle","rvol","kScore","kyleLambda","vScore","cScore","rScore","tier1Score","computeVPIN","lookbackBars","Array","isArray","imbalances","volBuy","volSell","imb","vp","percent","computeHurstExponent","map","h","N","maxK","ks","rs","k","segments","Rsum","seg","cum","c","d","RS","log","meanK","meanR","hurst","computeVolumeProfilePOC","bins","minP","maxP","binSize","profile","fill","maxIdx","maxV","totalV","poc","target","areaV","left","right","valueAreaLow","valueAreaHigh","totalVolume","computeDepthImbalance","snapshot","bid","bidDepth","bid_size","bids_size","ask","askDepth","ask_size","asks_size","calculateSmartMoneyIndex","data","analytics","_analytics","totalFreq","freqBuy2h","freqSell2h","smi","volBuy_vs_avg_percent","volDurability2h_percent","avgVolPerTrade","histAvgVolPerTrade","avgBuy2h","avgSell2h","avgFreqBuy2h","avgFreqSell2h","calculateTradeIntensity","avgVolBuy","avgVolSell","avgFreqBuy","avgFreqSell","volIntensity","freqIntensity","intensity","level","calculateAccumulationScore","volDur2h","volDur24h","volDurability24h_percent","sign","calculateMomentumDivergence","priceChange","percent_change","flowBias","divergence","calculateWhaleActivity","volVsAvg","volDur","whaleScore","calculateRetailInstitutionalRatio","whale","clampedRatio","type","calculatePressureIndex","pressure","freqRatio2h_percent","volImbalance2h","direction","calculateOrderFlowImbalance","freqBuy","freqSell","volDen","freqDen","volImb","freqImb","combined","interp","cls","volImbalance","freqImbalance","calculateVolumeProfile","valueAreaPercent","_history","pocPrice","pocBin","points","volume","size","qty","pt","Infinity","avgPrice","binCount","width","buckets","maxVol","collected","leftVol","rightVol","actualValueAreaPercent","binWidth","minPrice","maxPrice","detectLiquiditySweep","recent","getVolFields","windowSize","recentWindow","sumBuy","sumSell","count","vf","avgBuy","avgSell","recentV","buyRatio","sellRatio","priceNow","prevPrice","pricePct","side","confidence","totalAvg","totalSpikeRatio","sweep","calculateTrendStrength","biasConsistency","calculateBreakoutProbability","compressionScore","intensityScore","imbalanceScore","pricePos","pricePosition","extremeScore","prob","factors","compression","imbalance","extreme","calculateLiquidityStressIndex","avgTradeValue","liquidity_avg_trade_value","total_vol_fiat","totalVolFiat","lsi","classifyMarketMode","atrPercent","isLowVol","isHighVol","hasBias","biasDirection","mode","bias","includes","detectRegimeTransition","atr","atrPct","regime","lowVol","highVol","durDelta","atrShort","volDurDelta","generateSmartSignal","accum","calculateMultiTimeframeConfluence","timeframes","weights","pr","e","agg","totalWeight","tf","rec","calculateRecommendation","recommendation","conf","wt","contrib","timeframe","weight","consensus","confluence","breakdown","computeAllSmartMetrics","ofi","volumeProfile","liquiditySweep","regimeTransition","multiTfConfluence","accumScore","riRatio","trendStrength","breakout","marketMode","smartSignal","SCALES","THRESHOLDS","DEFAULTS","AnalyticsCore"],"mappings":"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"}